<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Projects</title>

  <!-- Existing stylesheet link -->
  <link rel="stylesheet" href="style.css">

  <!-- Page-scoped styles for filters, badges, and PAAO formatting -->
  <style>
    .project-filters{display:flex;flex-wrap:wrap;gap:.5rem;margin:0 0 1.25rem}
    .project-filters .chip{border:1px solid var(--border,rgba(0,0,0,.12));background:var(--card,#fff);
      padding:.4rem .75rem;border-radius:999px;cursor:pointer;font:inherit}
    .project-filters .chip.is-active{box-shadow:0 0 0 2px var(--accent, #0a7f51) inset;color:var(--accent-ink,#0a7f51)}
    .project-card[hidden]{display:none !important}
    .case-dialog{max-width:min(980px,95vw)}
    .case-dialog .case-media{display:flex;justify-content:center;align-items:center;min-height:240px;margin:0 0 .75rem}
    .case-dialog .case-media img{max-width:100%;height:auto;cursor:pointer}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}

    /* Tag badges generated from data-tags */
    .card-tags{display:flex;flex-wrap:wrap;gap:.35rem;margin:.5rem 0}
    .card-tag{font-size:.75rem;line-height:1;border:1px solid var(--border,rgba(0,0,0,.14));
      background:var(--card,#fff);padding:.25rem .5rem;border-radius:999px;white-space:nowrap}

    /* Nicer P→A→A→O label styling inside brief */
    .paao-inline{display:block;font-weight:600;margin:.25rem 0 .25rem}
    .paao-inline .sep{opacity:.6;padding:0 .25rem}
    .project-brief{margin:.5rem 0 0}
  </style>
</head>
<body>
  <header class="site-header">
    <button class="menu-toggle" aria-expanded="false">Menu</button>
    <nav id="nav-links"></nav>
  </header>

  <main class="container container-wide">
    <!-- Filter bar -->
    <div class="project-filters" role="group" aria-label="Filter projects">
      <button class="chip is-active" data-filter="all" aria-pressed="true">All</button>
      <button class="chip" data-filter="rcm" aria-pressed="false">RCM</button>
      <button class="chip" data-filter="condition" aria-pressed="false">Condition</button>
      <button class="chip" data-filter="planning" aria-pressed="false">Planning</button>
      <button class="chip" data-filter="dashboards" aria-pressed="false">Dashboards</button>
      <button class="chip" data-filter="qa" aria-pressed="false">QA</button>
    </div>
    <p class="sr-only" aria-live="polite" id="filterStatus"></p>

    <!-- Projects grid -->
    <section class="grid projects-grid">
      <article class="project-card card" data-tags="condition,rca" data-case="d375pump">
        <header class="card-head"><h3 class="card-title">D375 Water Pump Failures</h3></header>
        <p class="project-brief">P: Hydraulic failures on D375. A: Trend oil Fe ppm; inspect. A: Flush, filter change, torque checks. O: MTBF ↑</p>
        <button class="project-open">Open</button>
      </article>

      <article class="project-card card" data-tags="dashboards,planning" data-case="oiltrack">
        <header class="card-head"><h3 class="card-title">Oil Tracking Dashboard</h3></header>
        <p class="project-brief">P: Scattered sampling data. A: Consolidated DB schema. A: PowerBI dashboards with auto-alerts. O: Faster root cause detection</p>
        <button class="project-open">Open</button>
      </article>

      <!-- …repeat other 7 cards with data-tags and brief… -->
    </section>

    <!-- Dialog for cases -->
    <dialog class="case-dialog">
      <div class="case-media"><img alt=""></div>
      <div class="case-body"></div>
      <button class="case-close">Close</button>
      <button class="case-prev">Prev</button>
      <button class="case-next">Next</button>
    </dialog>
  </main>

  <!-- Case templates (example) -->
  <template id="case-d375pump">
    <h2>D375 Water Pump Failures</h2>
    <p>Full write-up here with multiple images and details…</p>
    <img src="img/pump1.jpg" alt="Damaged driven gear">
    <img src="img/pump2.jpg" alt="Second failure gear">
  </template>

  <template id="case-oiltrack">
    <h2>Oil Tracking Dashboard</h2>
    <p>Write-up here with visuals…</p>
    <img src="img/dashboard1.png" alt="Dashboard example">
  </template>

  <!-- Scripts -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js" defer></script>
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    if (window.AOS) AOS.init({ once:true, duration:700, easing:'ease-out-cubic' });

    // Mobile nav toggle
    const toggle = document.querySelector('.menu-toggle');
    const links = document.getElementById('nav-links');
    if (toggle && links) {
      toggle.addEventListener('click', () => {
        const open = links.classList.toggle('show');
        toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    }

    // Header shadow
    const header = document.querySelector('.site-header');
    const setShadow = () => header.classList.toggle('scrolled', window.scrollY > 8);
    setShadow(); window.addEventListener('scroll', setShadow, { passive:true });

    const cards = Array.from(document.querySelectorAll('.project-card'));
    const ids = cards.map(c => c.getAttribute('data-case'));

    const dlg = document.querySelector('.case-dialog');
    const dlgImg = dlg.querySelector('.case-media img');
    const dlgBody = dlg.querySelector('.case-body');
    const btnClose = dlg.querySelector('.case-close');
    const btnPrev = dlg.querySelector('.case-prev');
    const btnNext = dlg.querySelector('.case-next');

    let currentIndex = 0;
    let gallery = [];
    let galleryIdx = 0;
    let lastFocus = null;

    function loadCase(id){
      const tpl = document.getElementById('case-' + id);
      if (!tpl) return;
      dlgBody.innerHTML = ''; gallery = []; galleryIdx = 0;
      const frag = tpl.content.cloneNode(true);
      frag.querySelectorAll('img').forEach(img => {
        gallery.push({ src: img.getAttribute('src'), alt: img.getAttribute('alt')||'' });
        img.remove();
      });
      if (gallery.length){
        dlgImg.src = gallery[0].src; dlgImg.alt = gallery[0].alt; galleryIdx=0;
      } else { dlgImg.src=''; dlgImg.alt=''; }
      dlgBody.appendChild(frag);
    }
    function openCaseAt(i){
      currentIndex = (i+ids.length)%ids.length;
      loadCase(ids[currentIndex]);
      lastFocus=document.activeElement;
      dlg.showModal(); setHashForCurrent(); btnClose.focus();
    }
    function stepCase(d){ openCaseAt(currentIndex+d); }
    function stepImage(d){ if(!gallery.length)return; galleryIdx=(galleryIdx+d+gallery.length)%gallery.length;
      dlgImg.src=gallery[galleryIdx].src; dlgImg.alt=gallery[galleryIdx].alt||''; }

    cards.forEach((card,i)=>{ card.querySelector('.project-open')
      .addEventListener('click',()=>openCaseAt(i)); });

    btnClose.addEventListener('click',()=>closeDialog());
    btnPrev.addEventListener('click',()=>stepCase(-1));
    btnNext.addEventListener('click',()=>stepCase(1));
    dlgImg.addEventListener('click',(e)=>stepImage(e.shiftKey?-1:1));
    function closeDialog(){ dlg.close(); clearHashCase(); if(lastFocus) lastFocus.focus(); }

    dlg.addEventListener('click',e=>{ if(e.target===dlg) closeDialog(); });
    document.addEventListener('keydown',e=>{
      if(!dlg.open)return;
      if(e.key==='Escape')closeDialog();
      if(e.key==='ArrowRight')stepCase(1);
      if(e.key==='ArrowLeft')stepCase(-1);
      if(e.key==='PageDown')stepImage(1);
      if(e.key==='PageUp')stepImage(-1);
    });

    // Filtering
    const chips=Array.from(document.querySelectorAll('.project-filters .chip'));
    const status=document.getElementById('filterStatus');
    function applyFilter(t){
      t=(t||'all').toLowerCase();
      const params=new URLSearchParams(location.search);
      if(t==='all')params.delete('filter'); else params.set('filter',t);
      history.replaceState({},'',location.pathname+(params.toString()?'?'+params.toString():'')+location.hash);
      let vis=0;
      cards.forEach(c=>{
        const tags=(c.getAttribute('data-tags')||'').toLowerCase();
        const show=(t==='all')||tags.split(',').map(s=>s.trim()).includes(t);
        c.hidden=!show; if(show)vis++;
        if(!c.querySelector('.card-tags')){
          const wrap=document.createElement('div'); wrap.className='card-tags';
          c.insertBefore(wrap,c.querySelector('.project-brief'));
          (c.getAttribute('data-tags')||'').split(',').forEach(tag=>{
            if(tag.trim()){const b=document.createElement('span');b.className='card-tag';
              b.textContent=tag.trim()[0].toUpperCase()+tag.trim().slice(1);wrap.appendChild(b);} });
        }
      });
      chips.forEach(c=>{const on=c.dataset.filter===t||(t==='all'&&c.dataset.filter==='all');
        c.classList.toggle('is-active',on);c.setAttribute('aria-pressed',on?'true':'false');});
      if(status)status.textContent=`${vis} project${vis===1?'':'s'} shown for filter: ${t}.`;
    }
    chips.forEach(ch=>ch.addEventListener('click',()=>applyFilter(ch.dataset.filter)));

    // Deep-link
    function setHashForCurrent(){const id=ids[currentIndex];
      const params=new URLSearchParams(location.search);
      history.replaceState({},'',location.pathname+(params.toString()?'?'+params.toString():'')+'#case-'+id);}
    function clearHashCase(){const params=new URLSearchParams(location.search);
      history.replaceState({},'',location.pathname+(params.toString()?'?'+params.toString():''): '');}
    function openFromUrl(){
      const params=new URLSearchParams(location.search);
      const filter=params.get('filter'); if(filter)applyFilter(filter); else applyFilter('all');
      const hash=location.hash||'';const m=hash.match(/^#case-([a-z0-9_-]+)$/i);
      const q=params.get('case');const wanted=m?m[1]:(q||null);
      if(wanted){const idx=ids.indexOf(wanted);if(idx>=0)openCaseAt(idx);}
    }
    window.addEventListener('hashchange',()=>{const m=(location.hash||'').match(/^#case-([a-z0-9_-]+)$/i);
      if(!m){if(dlg.open)closeDialog();return;}const idx=ids.indexOf(m[1]);if(idx>=0)openCaseAt(idx);});
    openFromUrl();

    // Reformat briefs as Problem→Analysis→Action→Outcome
    cards.forEach(card=>{
      const brief=card.querySelector('.project-brief'); if(!brief)return;
      const raw=brief.textContent.trim();
      const parts=raw.split(/[.;]/).filter(Boolean);
      const wrap=document.createElement('div');wrap.className='paao-inline';
      const mk=(lbl,txt)=>txt?`<span class="lbl">${lbl}:</span> <span class="txt">${txt.trim()}</span>`:'';
      const items=[mk('Problem',parts[0]||''),mk('Analysis',parts[1]||''),mk('Action',parts[2]||''),mk('Outcome',parts[3]||'')].filter(Boolean);
      if(items.length){wrap.innerHTML=items.join('<span class="sep">→</span>');brief.innerHTML='';brief.appendChild(wrap);}
    });
  });
  </script>
</body>
</html>
